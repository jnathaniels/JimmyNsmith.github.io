<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">

    <!--include Handlebars from CDN-->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/handlebars.js/4.1.2/handlebars.min.js"></script>
    <title>students</title>
</head>

<body style='margin-left: 30px;'>

    <h1>Select A Major</h1>


    <button type='button' class="btn" onClick="getData('CIT')">CIT Majors</button>
    <button type='button' class="btn" onClick="getData('BUS')">Business Majors</button>

    <p>We filter our dataset by major</p>

    <div id="result"></div>

    <script type="text/x-handlebars-template" id="tableTemplate">
    <table cellspacing='12'>
        <tr><th>Name</th><th>Major</th><th>Midterm</th><th>Final</th></tr>
            {{#each rows}}
                <tr>
                    <td>{{name}}</td><td>{{major}}</td><td>{{midterm}}</td><td>{{final}}</td>
                </tr>
            {{/each}}
    </table>
</script>

    <script>

        function getData(selected_major) {
            var request = new XMLHttpRequest();
            request.open('GET', 'cit5students.json');

            request.onload = function () {
                var data = JSON.parse(request.responseText);

                majors = data.filter(getMajors)
                function getMajors(item) {
                    return item.major == selected_major;
                }

                if (request.status == 200) {
                    var templateText = document.getElementById('tableTemplate').innerHTML;
                    var compiledTemplateText = Handlebars.compile(templateText);
                    compiledHtml = compiledTemplateText({ rows: majors })
                    document.getElementById('result').innerHTML = compiledHtml;
                }
                else {
                    document.querySelector('#result').innerHTML = "There was an error";
                }
            }

            request.send(null);
        }
    </script>

</body>
</html>
